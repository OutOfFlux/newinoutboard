<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>In/Out Board</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-page: #f0f2f5;
      --bg-card: #fff;
      --bg-header: #f9fafb;
      --bg-header-hover: #f3f4f6;
      --bg-hover: #fafbfc;
      --bg-editable-hover: #f3f4f6;
      --bg-input: #fff;
      --text-primary: #1a1a1a;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --border-main: #e5e7eb;
      --border-light: #f0f0f0;
      --border-input: #d1d5db;
      --shadow: rgba(0,0,0,0.08);
      --separator: #ccc;
      --badge-green-bg: #dcfce7;
      --badge-green-text: #15803d;
      --badge-yellow-bg: #fef9c3;
      --badge-yellow-text: #854d0e;
      --row-yellow-bg: #fef9c3;
      --row-yellow-hover: #fef08a;
      --badge-red-bg: #fee2e2;
      --badge-red-text: #b91c1c;
      --row-red-bg: #fee2e2;
      --row-red-hover: #fecaca;
      --link-color: #3b82f6;
      --focus-border: #3b82f6;
    }

    [data-theme="dark"] {
      --bg-page: #111827;
      --bg-card: #1f2937;
      --bg-header: #283040;
      --bg-header-hover: #374151;
      --bg-hover: #283040;
      --bg-editable-hover: #374151;
      --bg-input: #374151;
      --text-primary: #f3f4f6;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --border-main: #374151;
      --border-light: #2d3748;
      --border-input: #4b5563;
      --shadow: rgba(0,0,0,0.3);
      --separator: #4b5563;
      --badge-green-bg: #064e3b;
      --badge-green-text: #6ee7b7;
      --badge-yellow-bg: #713f12;
      --badge-yellow-text: #fde68a;
      --row-yellow-bg: #2e1f05;
      --row-yellow-hover: #3d2a0a;
      --badge-red-bg: #7f1d1d;
      --badge-red-text: #fca5a5;
      --row-red-bg: #3b1111;
      --row-red-hover: #4c1515;
      --link-color: #60a5fa;
      --focus-border: #60a5fa;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-page);
      color: var(--text-primary);
      line-height: 1.5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    /* Summary bar */
    .summary-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: var(--bg-card);
      border-radius: 8px;
      box-shadow: 0 1px 3px var(--shadow);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .summary-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .summary-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }

    .summary-dot.green { background: #16a34a; }
    .summary-dot.yellow { background: #ca8a04; }
    .summary-dot.red { background: #dc2626; }

    .summary-separator {
      color: var(--separator);
      user-select: none;
    }

    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 16px;
      align-items: center;
    }

    .controls select,
    .controls input {
      padding: 8px 12px;
      border: 1px solid var(--border-input);
      border-radius: 6px;
      font-size: 0.875rem;
      background: var(--bg-input);
      color: var(--text-primary);
    }

    .controls input {
      flex: 1;
      min-width: 200px;
      max-width: 320px;
    }

    .controls select { min-width: 160px; }

    /* Table wrapper */
    .table-wrap {
      background: var(--bg-card);
      border-radius: 8px;
      box-shadow: 0 1px 3px var(--shadow);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    thead th {
      text-align: left;
      padding: 12px 14px;
      background: var(--bg-header);
      border-bottom: 2px solid var(--border-main);
      font-weight: 600;
      white-space: nowrap;
      user-select: none;
    }

    th.sortable {
      cursor: pointer;
    }

    th.sortable:hover {
      background: var(--bg-header-hover);
    }

    th .sort-arrow {
      margin-left: 4px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    th .sort-arrow.active {
      color: var(--text-primary);
    }

    tbody td {
      padding: 10px 14px;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
    }

    tbody tr:hover {
      background: var(--bg-hover);
    }

    tbody tr.row-yellow {
      background: var(--row-yellow-bg);
    }

    tbody tr.row-yellow:hover {
      background: var(--row-yellow-hover);
    }

    tbody tr.row-red {
      background: var(--row-red-bg);
    }

    tbody tr.row-red:hover {
      background: var(--row-red-hover);
    }

    /* Status badge */
    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 9999px;
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .badge.green {
      background: var(--badge-green-bg);
      color: var(--badge-green-text);
    }

    .badge.yellow {
      background: var(--badge-yellow-bg);
      color: var(--badge-yellow-text);
    }

    .badge.red {
      background: var(--badge-red-bg);
      color: var(--badge-red-text);
    }

    /* Editable cells */
    .editable {
      cursor: pointer;
      border-radius: 4px;
      padding: 2px 4px;
      min-height: 1.5em;
      transition: background 0.15s;
    }

    .editable:hover {
      background: var(--bg-editable-hover);
    }

    .editable.empty {
      color: var(--text-muted);
      font-style: italic;
    }

    /* Inline edit inputs */
    td input[type="text"],
    td select {
      width: 100%;
      padding: 4px 8px;
      border: 2px solid var(--focus-border);
      border-radius: 4px;
      font-size: 0.875rem;
      outline: none;
      background: var(--bg-input);
      color: var(--text-primary);
    }

    td select {
      cursor: pointer;
    }

    td select optgroup {
      font-weight: 700;
      font-style: normal;
      color: var(--text-secondary);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    td select option {
      font-weight: 500;
      font-size: 0.875rem;
      padding: 4px 8px;
      color: var(--text-primary);
    }

    /* Timestamp */
    .timestamp {
      color: var(--text-secondary);
      font-size: 0.8rem;
      white-space: nowrap;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .container { padding: 12px; }

      h1 { font-size: 1.25rem; }

      table { font-size: 0.8rem; }

      thead th, tbody td { padding: 8px 8px; }

      .controls { gap: 8px; }
      .controls input { max-width: 100%; min-width: 0; }

      /* Hide less critical columns on small screens */
      .col-vehicle,
      .col-estimated-return,
      .col-last-changed {
        display: none;
      }
    }

    /* Connection indicator */
    .connection-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: var(--text-secondary);
      float: right;
    }

    .connection-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #dc2626;
    }

    .connection-dot.connected {
      background: #16a34a;
    }

    /* Dark mode toggle */
    .dark-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      user-select: none;
    }

    .dark-toggle-track {
      width: 36px;
      height: 20px;
      border-radius: 10px;
      background: var(--border-input);
      position: relative;
      transition: background 0.2s;
    }

    .dark-toggle-track .thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #fff;
      position: absolute;
      top: 2px;
      left: 2px;
      transition: transform 0.2s;
    }

    [data-theme="dark"] .dark-toggle-track {
      background: #3b82f6;
    }

    [data-theme="dark"] .dark-toggle-track .thumb {
      transform: translateX(16px);
    }
    /* Footer */
    .page-footer {
      text-align: center;
      padding: 24px 0 12px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-bottom:16px;">
      <div style="display:flex; align-items:center; gap:12px;">
        <img src="/logo.png" alt="Logo" style="width:120px; height:40px; object-fit:contain;">
        <h1>In/Out Board</h1>
      </div>
      <div style="display:flex; align-items:center; gap:16px;">
        <label class="dark-toggle" id="darkToggle">
          <span class="dark-toggle-track"><span class="thumb"></span></span>
          <span>Dark</span>
        </label>
        <a href="/admin.html" style="color:var(--link-color); text-decoration:none; font-size:0.875rem; font-weight:500;">Manage Employees</a>
        <span class="connection-status">
          <span class="connection-dot" id="connDot"></span>
          <span id="connLabel">Connecting...</span>
        </span>
      </div>
    </div>

    <div class="summary-bar" id="summaryBar"></div>

    <div class="controls">
      <select id="deptFilter">
        <option value="">All Departments</option>
      </select>
      <input type="text" id="nameSearch" placeholder="Search by name...">
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th class="sortable" data-sort="name">Name <span class="sort-arrow" id="arrow-name">&#9650;</span></th>
            <th class="sortable" data-sort="department">Department <span class="sort-arrow" id="arrow-department"></span></th>
            <th class="sortable" data-sort="status">Status <span class="sort-arrow" id="arrow-status"></span></th>
            <th>Comment</th>
            <th class="col-vehicle">Vehicle</th>
            <th class="col-estimated-return">Est. Return</th>
            <th class="col-last-changed">Last Changed</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <footer class="page-footer">In/Out Board v<span id="footerVersion"></span></footer>

  <script>
    // --- Constants ---
    const GREEN_STATUSES = ['IN'];
    const YELLOW_STATUSES = ['In Meeting', 'On Break', 'At Lunch', 'Away from Desk'];
    const RED_STATUSES = ['OUT', 'Working Remotely', 'PTO', 'Sick'];
    const ALL_STATUSES = [...GREEN_STATUSES, ...YELLOW_STATUSES, ...RED_STATUSES];

    function statusColor(status) {
      if (GREEN_STATUSES.includes(status)) return 'green';
      if (YELLOW_STATUSES.includes(status)) return 'yellow';
      return 'red';
    }

    // --- State ---
    let employees = [];
    let vehicles = [];
    let sortCol = 'name';
    let sortAsc = true;
    let ws = null;

    // --- DOM refs ---
    const tableBody = document.getElementById('tableBody');
    const summaryBar = document.getElementById('summaryBar');
    const deptFilter = document.getElementById('deptFilter');
    const nameSearch = document.getElementById('nameSearch');
    const connDot = document.getElementById('connDot');
    const connLabel = document.getElementById('connLabel');
    const darkToggle = document.getElementById('darkToggle');

    // --- Dark mode ---
    function applyTheme(dark) {
      document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
      localStorage.setItem('theme', dark ? 'dark' : 'light');
    }

    darkToggle.addEventListener('click', () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      applyTheme(!isDark);
    });

    // Initialize from saved preference or system preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      applyTheme(savedTheme === 'dark');
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      applyTheme(true);
    }

    // --- WebSocket ---
    function connectWs() {
      const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
      ws = new WebSocket(`${protocol}//${location.host}`);

      ws.addEventListener('open', () => {
        connDot.classList.add('connected');
        connLabel.textContent = 'Connected';
      });

      ws.addEventListener('close', () => {
        connDot.classList.remove('connected');
        connLabel.textContent = 'Disconnected — reconnecting...';
        setTimeout(connectWs, 2000);
      });

      ws.addEventListener('message', (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'init') {
          employees = data.employees;
          vehicles = data.vehicles || [];
          refreshDeptFilter();
          render();
        } else if (data.type === 'employee_updated') {
          const idx = employees.findIndex(e => e.id === data.employee.id);
          if (idx !== -1) {
            employees[idx] = data.employee;
          }
          refreshDeptFilter();
          render();
        } else if (data.type === 'employee_added') {
          employees.push(data.employee);
          employees.sort((a, b) => a.name.localeCompare(b.name));
          refreshDeptFilter();
          render();
        } else if (data.type === 'employee_removed') {
          employees = employees.filter(e => e.id !== data.id);
          refreshDeptFilter();
          render();
        } else if (data.type === 'vehicle_added') {
          vehicles.push(data.vehicle);
          vehicles.sort((a, b) => a.name.localeCompare(b.name));
          render();
        } else if (data.type === 'vehicle_updated') {
          const idx = vehicles.findIndex(v => v.id === data.vehicle.id);
          if (idx !== -1) vehicles[idx] = data.vehicle;
          render();
        } else if (data.type === 'vehicle_removed') {
          vehicles = vehicles.filter(v => v.id !== data.id);
          render();
        }
      });
    }

    connectWs();

    // --- API helper ---
    async function updateEmployee(id, fields) {
      const res = await fetch(`/employees/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(fields),
      });
      if (!res.ok) {
        console.error('Update failed', await res.text());
      }
    }

    // --- Filtering & sorting ---
    function getFilteredSorted() {
      let list = [...employees];

      const dept = deptFilter.value;
      if (dept) {
        list = list.filter(e => e.department === dept);
      }

      const search = nameSearch.value.trim().toLowerCase();
      if (search) {
        list = list.filter(e => e.name.toLowerCase().includes(search));
      }

      list.sort((a, b) => {
        let cmp;
        if (sortCol === 'status') {
          cmp = ALL_STATUSES.indexOf(a.status) - ALL_STATUSES.indexOf(b.status);
        } else {
          const aVal = (a[sortCol] || '').toLowerCase();
          const bVal = (b[sortCol] || '').toLowerCase();
          cmp = aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
        }
        return sortAsc ? cmp : -cmp;
      });

      return list;
    }

    // --- Department filter ---
    function refreshDeptFilter() {
      const current = deptFilter.value;
      const depts = [...new Set(employees.map(e => e.department))].sort();
      deptFilter.innerHTML = '<option value="">All Departments</option>';
      depts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        if (d === current) opt.selected = true;
        deptFilter.appendChild(opt);
      });
    }

    deptFilter.addEventListener('change', render);
    nameSearch.addEventListener('input', render);

    // --- Sorting ---
    document.querySelectorAll('th.sortable').forEach(th => {
      th.addEventListener('click', () => {
        const col = th.dataset.sort;
        if (sortCol === col) {
          sortAsc = !sortAsc;
        } else {
          sortCol = col;
          sortAsc = true;
        }
        updateSortArrows();
        render();
      });
    });

    function updateSortArrows() {
      document.querySelectorAll('.sort-arrow').forEach(el => {
        el.classList.remove('active');
        el.innerHTML = '';
      });
      const arrow = document.getElementById(`arrow-${sortCol}`);
      if (arrow) {
        arrow.classList.add('active');
        arrow.innerHTML = sortAsc ? '&#9650;' : '&#9660;';
      }
    }

    // --- Summary bar ---
    function renderSummary() {
      const counts = {};
      ALL_STATUSES.forEach(s => counts[s] = 0);
      employees.forEach(e => {
        if (counts[e.status] !== undefined) counts[e.status]++;
      });

      const items = [];
      ALL_STATUSES.forEach(s => {
        if (counts[s] > 0) {
          const color = statusColor(s);
          items.push(`<span class="summary-item"><span class="summary-dot ${color}"></span>${counts[s]} ${s}</span>`);
        }
      });

      summaryBar.innerHTML = items.join('<span class="summary-separator">&middot;</span>');
    }

    // --- Format timestamp ---
    function formatAbsoluteTimestamp(ts) {
      if (!ts) return '';
      const d = new Date(ts + 'Z');
      return d.toLocaleString(undefined, {
        month: 'short', day: 'numeric',
        hour: 'numeric', minute: '2-digit',
      });
    }

    function formatRelativeTimestamp(ts) {
      if (!ts) return '';
      const d = new Date(ts + 'Z');
      const now = new Date();
      const diffMs = now - d;
      const diffMin = Math.floor(diffMs / 60000);
      const diffHrs = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMin < 1) return 'Just now';
      if (diffMin < 60) return `${diffMin} min ago`;
      if (diffHrs < 24) return `${diffHrs} hr${diffHrs > 1 ? 's' : ''} ago`;
      return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
    }

    // --- Render table ---
    function render() {
      renderSummary();
      const list = getFilteredSorted();

      tableBody.innerHTML = '';
      list.forEach(emp => {
        const tr = document.createElement('tr');
        const color = statusColor(emp.status);
        if (color === 'yellow') tr.classList.add('row-yellow');
        if (color === 'red') tr.classList.add('row-red');

        if (emp.status !== 'IN') {
          tr.title = 'Double-click to mark IN';
          tr.addEventListener('dblclick', () => {
            updateEmployee(emp.id, { status: 'IN' });
            emp.status = 'IN';
            emp.comment = '';
            emp.estimated_return = '';
            emp.vehicle_id = null;
            emp.vehicle_name = '';
            render();
          });
        }

        // Name
        const tdName = document.createElement('td');
        tdName.textContent = emp.name;
        tr.appendChild(tdName);

        // Department
        const tdDept = document.createElement('td');
        tdDept.textContent = emp.department;
        tr.appendChild(tdDept);

        // Status (editable dropdown)
        const tdStatus = document.createElement('td');
        const badge = document.createElement('span');
        badge.className = `badge ${color} editable`;
        badge.textContent = emp.status;
        badge.addEventListener('click', () => openStatusEditor(tdStatus, emp));
        tdStatus.appendChild(badge);
        tr.appendChild(tdStatus);

        // Comment (editable)
        const tdComment = document.createElement('td');
        const commentSpan = document.createElement('span');
        commentSpan.className = 'editable' + (emp.comment ? '' : ' empty');
        commentSpan.textContent = emp.comment || 'Add comment...';
        commentSpan.addEventListener('click', () => openTextEditor(tdComment, emp, 'comment', 'Add comment...'));
        tdComment.appendChild(commentSpan);
        tr.appendChild(tdComment);

        // Vehicle (editable dropdown)
        const tdVehicle = document.createElement('td');
        tdVehicle.className = 'col-vehicle';
        const vehicleSpan = document.createElement('span');
        vehicleSpan.className = 'editable' + (emp.vehicle_name ? '' : ' empty');
        vehicleSpan.textContent = emp.vehicle_name || 'None';
        vehicleSpan.addEventListener('click', () => openVehicleEditor(tdVehicle, emp));
        tdVehicle.appendChild(vehicleSpan);
        tr.appendChild(tdVehicle);

        // Estimated Return (editable)
        const tdReturn = document.createElement('td');
        tdReturn.className = 'col-estimated-return';
        const returnSpan = document.createElement('span');
        returnSpan.className = 'editable' + (emp.estimated_return ? '' : ' empty');
        returnSpan.textContent = emp.estimated_return || 'Set return...';
        returnSpan.addEventListener('click', () => openTextEditor(tdReturn, emp, 'estimated_return', 'Set return...'));
        tdReturn.appendChild(returnSpan);
        tr.appendChild(tdReturn);

        // Last Changed
        const tdChanged = document.createElement('td');
        tdChanged.className = 'col-last-changed';
        const tsSpan = document.createElement('span');
        tsSpan.className = 'timestamp';
        tsSpan.textContent = formatRelativeTimestamp(emp.last_changed);
        tsSpan.title = formatAbsoluteTimestamp(emp.last_changed);
        tdChanged.appendChild(tsSpan);
        tr.appendChild(tdChanged);

        tableBody.appendChild(tr);
      });
    }

    // --- Inline editors ---
    const STATUS_GROUPS = [
      { label: 'Available', statuses: GREEN_STATUSES },
      { label: 'Unavailable', statuses: YELLOW_STATUSES },
      { label: 'Out of Office', statuses: RED_STATUSES },
    ];

    function openStatusEditor(td, emp) {
      td.innerHTML = '';
      const sel = document.createElement('select');

      STATUS_GROUPS.forEach(group => {
        const optgroup = document.createElement('optgroup');
        optgroup.label = group.label;
        group.statuses.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s;
          opt.textContent = s;
          if (s === emp.status) opt.selected = true;
          optgroup.appendChild(opt);
        });
        sel.appendChild(optgroup);
      });

      sel.addEventListener('change', () => {
        updateEmployee(emp.id, { status: sel.value });
        // Optimistic local update
        emp.status = sel.value;
        if (sel.value === 'IN') {
          emp.comment = '';
          emp.estimated_return = '';
          emp.vehicle_id = null;
          emp.vehicle_name = '';
        }
        render();
      });

      sel.addEventListener('blur', () => render());

      td.appendChild(sel);
      sel.focus();
    }

    function openVehicleEditor(td, emp) {
      td.innerHTML = '';
      const sel = document.createElement('select');

      const noneOpt = document.createElement('option');
      noneOpt.value = '';
      noneOpt.textContent = '(None)';
      if (!emp.vehicle_id) noneOpt.selected = true;
      sel.appendChild(noneOpt);

      vehicles.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v.id;
        const takenBy = employees.find(e => e.vehicle_id === v.id && e.id !== emp.id);
        if (takenBy) {
          opt.textContent = `${v.name} — taken by ${takenBy.name}`;
          opt.disabled = true;
        } else {
          opt.textContent = v.name;
        }
        if (v.id === emp.vehicle_id) opt.selected = true;
        sel.appendChild(opt);
      });

      sel.addEventListener('change', () => {
        const vehicleId = sel.value ? Number(sel.value) : null;
        const fields = { vehicle_id: vehicleId };
        // Auto-set status to OUT when picking a vehicle while IN
        if (vehicleId && emp.status === 'IN') {
          fields.status = 'OUT';
        }
        updateEmployee(emp.id, fields);
        emp.vehicle_id = vehicleId;
        emp.vehicle_name = vehicleId ? (vehicles.find(v => v.id === vehicleId) || {}).name || '' : '';
        if (fields.status) emp.status = fields.status;
        render();
      });

      sel.addEventListener('blur', () => render());

      td.appendChild(sel);
      sel.focus();
    }

    function openTextEditor(td, emp, field, placeholder) {
      td.innerHTML = '';
      const input = document.createElement('input');
      input.type = 'text';
      input.value = emp[field] || '';
      input.placeholder = placeholder;

      function save() {
        const val = input.value.trim();
        if (val !== (emp[field] || '')) {
          updateEmployee(emp.id, { [field]: val });
          emp[field] = val;
        }
        render();
      }

      input.addEventListener('blur', save);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          save();
        }
        if (e.key === 'Escape') {
          render();
        }
      });

      td.appendChild(input);
      input.focus();
      input.select();
    }

    // Initialize arrows
    updateSortArrows();

    // Refresh relative timestamps every 60 seconds
    setInterval(render, 60000);

    // --- Footer version ---
    fetch('/version').then(r => r.json()).then(({ version }) => {
      document.getElementById('footerVersion').textContent = version;
    });
  </script>
</body>
</html>
